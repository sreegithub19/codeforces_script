name: CI

on:
  push:
    branches:
      - solidity_
jobs:
  build:

    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Set up Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '18'

      - name: Install dependencies
        run: npm install && npm install --save-dev hardhat

      - name: Compile Solidity contracts
        run: npx hardhat compile

      - name: Run tests
        run: npx hardhat test

      - name: Start Hardhat node
        run: |
          npx hardhat node & sleep 5 
          
      - name: Start sol in js scripts
        run: |
          npx hardhat run scripts/deploy.js --network localhost && node scripts/solidity_in_js.js

      - name: Start sol in js_1 scripts
        run: |
          node scripts/solidity_in_js_1.js
      
      
      # The ampersand (&) runs the command in the background.

      # - name: Deploy and display message
      #   run: npx hardhat run scripts/deploy.js --network localhost

      # - name: Get message
      #   run: |
      #     node -e "
      #     const { ethers } = require('hardhat');
      #     async function main() {
      #       const HelloWorld = await ethers.getContractFactory('HelloWorld');
      #       const helloWorld = await HelloWorld.deploy();
      #       await helloWorld.deployed();
      #       const message = await helloWorld.message();
      #       console.log('Message from contract:', message);
      #     }
      #     main().catch((error) => {
      #       console.error(error);
      #       process.exit(1);
      #     });
      #     "