name: Dart CI

on:
  push:
    branches: [ dart_ ]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Install Dart
      uses: dart-lang/setup-dart@v1
      with:
        sdk: '3.4.0'

    - name: Get dependencies
      run: dart pub get

    - name: Run Dart application
      run: |
        dart pub global activate interactive
        
        dart run execute/hello.dart
        dart run execute/stub.dart

    - name: Run Dart in tmpfs
      run: |
        docker run --rm \
          --mount type=tmpfs,dst=/tmp/my_tmpfs,tmpfs-mode=1777 \
          ubuntu bash -c "
            apt-get update &&
            apt-get install -y wget unzip &&
            wget -qO- https://storage.googleapis.com/dart-archive/channels/stable/release/latest/sdk/dartsdk-linux-x64-release.zip > dart-sdk.zip &&
            unzip dart-sdk.zip -d /usr/lib &&
            export PATH=\$PATH:/usr/lib/dart-sdk/bin &&
            mkdir -p /tmp/my_tmpfs &&
            echo 'void main() { print(\"Hello from Dart in tmpfs!\"); }' > /tmp/my_tmpfs/myscript.dart &&
            dart /tmp/my_tmpfs/myscript.dart
          "


      # dart run execute/ins.dart

      
 #      python execute/dart_in_python.py
 #      echo 'print("Hello from Dart shell!");' | interactive
 #       echo 'print("Hello from Dart shell!");' | dart
 #      dart eval "print('Hello, runline Dart!');"
 #     echo "void main() { print('Hello, runline Dart!'); }" | dart run
 #      dart run -e "void main() { print('Hello, runline Dart!'); }"
 #      echo "void main() { print('Hello, runline Dart!'); }" | dart run --stdin
 #      dart run --eval "print('Hello, runline Dart!');"
 #      printf "void main() { print('Hello, runline Dart!'); }" | dart run
 #      dart run -c 'void main() { print("Hello from Dart!"); }'

#  dart run <<EOF
#        void main() {
#           print('Hello, runline Dart!');
#        }
#        EOF

    # - name: Compile Dart application
    #   run: dart compile exe execute/hello.dart -o execute /hello
