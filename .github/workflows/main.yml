name: Run GUI Application with Xvfb

on:
  push:
    branches:
      - scilab_

jobs:
  run-with-xvfb:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Install dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y openjdk-11-jdk  # Install required dependencies

    - name: Install Scilab
      run: |
        wget https://www.scilab.org/download/6.1.1/scilab-6.1.1.bin.linux-x86_64.tar.gz
        tar -xzf scilab-6.1.1.bin.linux-x86_64.tar.gz
        sudo mv scilab-6.1.1 /opt/scilab
        sudo ln -s /opt/scilab/bin/scilab-cli /usr/local/bin/scilab-cli

    - name: Install libtinfo5
      run: |
        # Download the libtinfo5 package
        wget http://archive.ubuntu.com/ubuntu/pool/main/n/ncurses/libtinfo5_6.1-1ubuntu1_amd64.deb
        # Install the package using dpkg
        sudo dpkg -i libtinfo5_6.1-1ubuntu1_amd64.deb
        # Fix any missing dependencies
        sudo apt-get install -f -y

    - name: Run all SCILAB files in the folder
      run: |
        mkdir -p output
        # Make sure the script is executable
        chmod +x ./run_all_scilab_files.sh
        # Execute the shell script that runs all .sci files
        ./run_all_scilab_files.sh

    - name: Run Scilab with GUI
      run: |
        scilab-cli -nb -e "disp('Hello from inline Scilab!');"  # Run Scilab or your GUI application

    # - name: Upload plot artifact
    #   uses: actions/upload-artifact@v4
    #   with:
    #     name: all-plots
    #     path: output  # Path to the generated plot files
