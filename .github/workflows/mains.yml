name: Python Flask Web Server

on:
  push:
    branches:
      - c_sharp  # Change to your default branch
  pull_request:

jobs:
  run-server:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.9'  # Specify the Python version you want

      - name: Install Flask
        run: |
          python -m pip install --upgrade pip
          pip install Flask

      - name: Create Flask app
        run: |
          mkdir -p app
          echo 'from flask import Flask, render_template_string' > app/app.py
          echo 'app = Flask(__name__)' >> app/app.py
          echo '' >> app/app.py
          echo '@app.route("/")' >> app/app.py
          echo 'def home():' >> app/app.py
          echo '    return """<h1>Home Page</h1>' >> app/app.py
          echo '    <p>Welcome to the Flask web server!</p>' >> app/app.py
          echo '    <ul>' >> app/app.py
          echo '        <li><a href="/about">About</a></li>' >> app/app.py
          echo '        <li><a href="/contact">Contact</a></li>' >> app/app.py
          echo '    </ul>"""' >> app/app.py
          echo '' >> app/app.py
          echo '@app.route("/about")' >> app/app.py
          echo 'def about():' >> app/app.py
          echo '    return "<h1>About Page</h1><p>This is the about page.</p>"' >> app/app.py
          echo '' >> app/app.py
          echo '@app.route("/contact")' >> app/app.py
          echo 'def contact():' >> app/app.py
          echo '    return "<h1>Contact Page</h1><p>Contact us at example@example.com</p>"' >> app/app.py
          echo '' >> app/app.py
          echo 'if __name__ == "__main__":' >> app/app.py
          echo '    app.run(host="0.0.0.0", port=8000)' >> app/app.py

      - name: Start Flask server
        run: |
          cd app
          python app.py &
          sleep 5  # Give the server some time to start

      - name: Fetch web pages
        run: |
          curl http://localhost:8000/ -o app/home.html
          curl http://localhost:8000/about -o app/about.html
          curl http://localhost:8000/contact -o app/contact.html

      - name: Upload web pages as artifacts
        uses: actions/upload-artifact@v4
        with:
          name: web-pages
          path: app/*.html
